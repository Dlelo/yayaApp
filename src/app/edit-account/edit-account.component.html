@if(userDetails$ | async; as userDetails){
  <div class="container my-4">
    <mat-card class="shadow-sm rounded-3 p-3">
      <div class="d-flex align-items-center mb-3">
        <mat-icon class="me-2 text-primary">edit</mat-icon>
        <h2>Edit My Account</h2>
      </div>
      @if(form){
        <form [formGroup]="form" class="row g-3">
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Name</mat-label>
              <input matInput formControlName="name" />
            </mat-form-field>
          </div>

          <div class="col-md-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Email</mat-label>
              <input matInput formControlName="email" />
            </mat-form-field>
          </div>

          <!-- HOUSEHELP fields -->

          @if(isHouseHelp){
            <div formGroupName="houseHelp">
              <h4 class="mt-4">Work Details</h4>

              <mat-form-field appearance="outline" class="w-100">
                <mat-label>National ID</mat-label>
                <input matInput formControlName="nationalId" />
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Skills (comma-separated)</mat-label>
                <input matInput formControlName="skills" />
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Years of Experience</mat-label>
                <input matInput type="number" formControlName="yearsOfExperience" />
              </mat-form-field>

              <!-- GOOD CONDUCT -->
              <div class="w-100 mb-3">
                <label class="block text-sm font-medium mb-2">Good Conduct</label>

                <label mat-stroked-button color="primary" class="ms-2 cursor-pointer flex items-center gap-1">
                  <mat-icon>attach_file</mat-icon>
                  <input
                    type="file"
                    hidden
                    accept="image/*,.pdf"
                    (change)="onFileSelected($event, 'goodConduct')"
                  />
                </label>

                @if(goodConductPreviewUrl || goodConductFileName) {
                  <div class="mt-2 flex items-center gap-3">
                    @if(goodConductPreviewUrl) {
                      <img
                        [src]="goodConductPreviewUrl"
                        alt="Good Conduct Preview"
                        class="h-20 w-auto rounded border"
                      />
                    } @else {
                      <span class="text-sm text-gray-600">{{ goodConductFileName }}</span>
                    }

                    <button
                      mat-icon-button
                      color="warn"
                      type="button"
                      (click)="removeFile('goodConduct')"
                      matTooltip="Remove file"
                    >
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                }
              </div>

              <!-- MEDICAL REPORT -->
              <div class="w-100 mb-3">
                <label class="block text-sm font-medium mb-2">Medical Report</label>

                <label mat-stroked-button color="primary" class="ms-2 cursor-pointer flex items-center gap-1">
                  <mat-icon>attach_file</mat-icon>
                  <input
                    type="file"
                    hidden
                    accept="image/*,.pdf"
                    (change)="onFileSelected($event, 'medicalReport')"
                  />
                </label>

                @if(medicalReportPreviewUrl || medicalReportFileName) {
                  <div class="mt-2 flex items-center gap-3">
                    @if(medicalReportPreviewUrl) {
                      <img
                        [src]="medicalReportPreviewUrl"
                        alt="Medical Report Preview"
                        class="h-20 w-auto rounded border"
                      />
                    } @else {
                      <span class="text-sm text-gray-600">{{ medicalReportFileName }}</span>
                    }

                    <button
                      mat-icon-button
                      color="warn"
                      type="button"
                      (click)="removeFile('medicalReport')"
                      matTooltip="Remove file"
                    >
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                }
              </div>


            </div>
          }

          <!-- HOMEOWNER fields -->
          @if(isHomeOwner){
            <div formGroupName="subscription">
              <h4 class="mt-4">Subscription</h4>

              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Plan</mat-label>
                <input matInput formControlName="plan" />
              </mat-form-field>

              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Status</mat-label>
                <mat-select formControlName="active">
                  <mat-option [value]="true">Active</mat-option>
                  <mat-option [value]="false">Inactive</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

          }

          <div class="d-flex justify-content-end mt-4 gap-2">
            <button mat-stroked-button color="warn" type="button" (click)="cancel()">Cancel</button>
            <button mat-flat-button color="primary" type="submit" (click)="save()">Save Changes</button>
          </div>
        </form>
      }
    </mat-card>
  </div>
}

