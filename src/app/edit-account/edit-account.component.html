@if(userDetails$ | async; as userDetails){
  <div class="container my-4">
    <mat-card class="shadow-sm rounded-3 p-3">
      <div class="d-flex align-items-center mb-3">
        <mat-icon class="me-2 text-primary">edit</mat-icon>
        <h2>Hi, {{userDetails.name}} update account details</h2>
      </div>
      @if(form){
        <form [formGroup]="form" class="row g-3">
          <mat-form-field appearance="outline" class="w-100">
            <mat-label>National ID</mat-label>
            <input matInput formControlName="nationalId" />
          </mat-form-field>

          <!-- NATIONAL ID UPLOAD -->
          <div class="w-100 mb-3">
            <label class="block text-sm font-medium mb-2">Attach National ID</label>

            <label mat-stroked-button color="primary" class="cursor-pointer flex items-center gap-1">
              <mat-icon>attach_file</mat-icon>
              <input
                type="file"
                hidden
                accept="image/*,.pdf"
                (change)="onFileSelected($event)"
              />
            </label>

            <!-- Preview -->
            @if(nationalIdPreviewUrl || nationalIdFileName){
              <div class="mt-2">
                  @if(nationalIdPreviewUrl){
                    <img [src]="nationalIdPreviewUrl" class="h-24 border rounded" />
                  }
                @if(!nationalIdPreviewUrl){
                  <span>{{ nationalIdFileName }}</span>
                }

                <button mat-icon-button color="warn" type="button" (click)="nationalIdFile=null; nationalIdPreviewUrl=null">
                  <mat-icon>delete</mat-icon>
                </button>
                @if(isHouseHelp){

                  <button
                    mat-flat-button
                    color="primary"
                    (click)="uploadNationalId(userDetails?.houseHelp?.id)">
                    Upload National ID
                  </button>

                }
                @if(isHomeOwner){
                  <button
                    mat-flat-button
                    color="primary"
                    (click)="uploadNationalId(userDetails?.homeOwner.id)">
                    Upload National ID
                  </button>
                }
              </div>

            }
            @if(uploadProgress > 0 && uploadProgress < 100){
              <mat-progress-bar
                mode="determinate"
                [value]="uploadProgress">
              </mat-progress-bar>
            }
          </div>

          <div class="w-50 mb-3">



          </div>


          <!-- HOUSEHELP fields -->

          @if(isHouseHelp){
            <div formGroupName="houseHelp">
              <div class="col-md-12">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Skills (comma-separated)</mat-label>
                <input matInput formControlName="skills" />
              </mat-form-field>
              </div>

              <div class="col-md-12">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Years of Experience</mat-label>
                <input matInput type="number" formControlName="yearsOfExperience" />
              </mat-form-field>
              </div>

              <div class="col-md-12">
                <mat-form-field appearance="outline" class="w-100">
                  <mat-label>Number of Children</mat-label>
                  <input matInput formControlName="numberOfChildren" type="number" />
                </mat-form-field>
              </div>

              <div class="col-md-12">
                <mat-form-field appearance="outline" class="w-100">
                  <mat-label>Religion</mat-label>
                  <input matInput formControlName="religion" />
                </mat-form-field>
              </div>

              <div class="col-md-12">
                <mat-form-field appearance="outline" class="w-100">
                  <mat-label>Level of Education</mat-label>
                  <input matInput formControlName="levelOfEducation" />
                </mat-form-field>
              </div>

              <div class="col-md-12">
                <mat-form-field appearance="outline" class="w-100">
                  <mat-label>Languages (comma-separated)</mat-label>
                  <input matInput formControlName="languages" />
                </mat-form-field>
              </div>

              <div class="col-md-12">
                <mat-form-field appearance="outline" class="w-100">
                  <mat-label>Current Location</mat-label>
                  <input matInput formControlName="currentLocation" />
                </mat-form-field>
              </div>

              <div class="col-md-12">
                <mat-form-field appearance="outline" class="w-100">
                  <mat-label>Contact person name</mat-label>
                  <input matInput formControlName="contactPersons" />
                </mat-form-field>
              </div>

              <div class="col-md-12">
                <mat-form-field appearance="outline" class="w-100">
                  <mat-label>Contact Person phone number</mat-label>
                  <input matInput formControlName="contactPersonsPhoneNumber" />
                </mat-form-field>
              </div>

              <div class="col-md-12">
                <mat-form-field appearance="outline" class="w-100">
                  <mat-label>Height in CM</mat-label>
                  <input matInput formControlName="height" type="number" />
                </mat-form-field>
              </div>

              <div class="col-md-12">
                <mat-form-field appearance="outline" class="w-100">
                  <mat-label>Weight in KG</mat-label>
                  <input matInput formControlName="weight" type="number" />
                </mat-form-field>
              </div>

            </div>
          }

          <!-- HOMEOWNER fields -->
          @if(isHomeOwner){
            <div formGroupName="homeOwner" class="row">
            <div class="col-md-12">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Number of Children</mat-label>
                <input matInput formControlName="numberOfDependents" type="number" />
              </mat-form-field>
            </div>
            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>House type</mat-label>
                <mat-select formControlName="houseType">
                  <mat-option [value]="true">Apartment</mat-option>
                  <mat-option [value]="false">Bungalow</mat-option>
                  <mat-option [value]="false">Mansionette</mat-option>
                </mat-select>
              </mat-form-field>
              </div>
            <div class="col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Number of bedrooms</mat-label>
                <input matInput formControlName="numberOfRooms" type="number" />
              </mat-form-field>
            </div>
            <div class="col-md-12">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Location</mat-label>
                <input matInput formControlName="homeLocation"/>
              </mat-form-field>
            </div>
            </div>
<!--            <div formGroupName="subscription">-->
<!--              <h4 class="mt-4">Subscription</h4>-->
<!--              <mat-form-field appearance="outline" class="w-100">-->
<!--                <mat-label>Plan</mat-label>-->
<!--                <input matInput formControlName="plan" />-->
<!--              </mat-form-field>-->

<!--              <mat-form-field appearance="outline" class="w-100">-->
<!--                <mat-label>Status</mat-label>-->
<!--                <mat-select formControlName="active">-->
<!--                  <mat-option [value]="true">Active</mat-option>-->
<!--                  <mat-option [value]="false">Inactive</mat-option>-->
<!--                </mat-select>-->
<!--              </mat-form-field>-->
<!--            </div>-->

          }

          <div class="d-flex justify-content-end mt-4 gap-2">
            <button mat-stroked-button color="warn" type="button" (click)="cancel()">Cancel</button>
            @if(isHouseHelp) {
              <button mat-flat-button color="primary" type="submit" (click)="save(userDetails?.houseHelp?.id)">
                Save Changes
              </button>
            }

            @if(isHomeOwner) {
              <button mat-flat-button color="primary" type="submit" (click)="save(userDetails?.homeOwner?.id)">Save Changes</button>
            }

          </div>
        </form>
      }
    </mat-card>
  </div>
}

