<div class="container mt-4">
  <h2 class="mb-4 text-center">Available Househelps</h2>

  <!-- FILTERS -->
  <mat-card class="mb-4 p-3 shadow-sm">
    <div class="row g-3">

      <!-- Experience -->
      <div class="col-md-3">
        <input
          type="number"
          class="form-control"
          placeholder="Min Experience (years)"
          [(ngModel)]="filters.experience"
        />
      </div>

      <!-- Location -->
      <div class="col-md-3">
        <input
          type="text"
          class="form-control"
          placeholder="Location"
          [(ngModel)]="filters.location"
        />
      </div>

      <!-- Availability -->
      <div class="col-md-3">
        <select
          class="form-select"
          [(ngModel)]="filters.houseHelpType"
        >
          <option [ngValue]="null">All Types</option>
          <option value="DAYBURG">Dayburg</option>
          <option value="LIVE_IN">Live-in</option>
          <option value="EMERGENCY">Emergency</option>
        </select>
      </div>

      <!-- Actions -->
      <div class="col-md-3 d-flex gap-2">
        <button mat-raised-button color="primary" (click)="applyFilters()">
          Apply Filters
        </button>

        <button mat-button color="warn" (click)="clearFilters()">
          Clear
        </button>
      </div>

    </div>
  </mat-card>

  <!-- House Help Cards -->
  <div class="row g-4">
    @for (houseHelp of (houseHelps$ | async)?.data; track houseHelp.id) {
      <div class="col-12 col-sm-6 col-md-4 col-lg-3">
        <mat-card class="househelp-card h-100">

          <!-- Profile Picture Section -->
          <div class="profile-header cover">

            @if (houseHelp.profilePictureDocument) {
              <img
                [src]="houseHelp.profilePictureDocument"
                [alt]="houseHelp.user?.name"
                class="cover-image"
              />
            } @else {
              <div class="cover-placeholder">
                <mat-icon class="placeholder-icon">person</mat-icon>
              </div>
            }

          <!-- Availability Badge -->
            <div class="availability-badge" [ngClass]="getAvailabilityClass(houseHelp.houseHelpType)">
              <mat-icon>schedule</mat-icon>
              {{ formatAvailability(houseHelp.houseHelpType) }}
            </div>
          </div>

          <mat-card-content class="card-body">
            <!-- Name and Rating -->
            <h5 class="name">{{ houseHelp.user?.name }}</h5>

            <div class="rating mb-2">
              <mat-icon class="star">star</mat-icon>
              <mat-icon class="star">star</mat-icon>
              <mat-icon class="star">star</mat-icon>
              <mat-icon class="star">star</mat-icon>
              <mat-icon class="star-outline">star_outline</mat-icon>
              <span class="rating-text">4.0</span>
            </div>

            <!-- Experience -->
            @if(houseHelp.yearsOfExperience){
              <div class="info-item">
                <mat-icon class="info-icon">work_history</mat-icon>
                <span>{{ houseHelp.yearsOfExperience }} years exp.</span>
              </div>
            }

            <!-- Location -->
            @if(houseHelp.currentLocation){
              <div class="info-item">
                <mat-icon class="info-icon">location_on</mat-icon>
                <span>{{ houseHelp.currentLocation }}</span>
              </div>
            }

            <!-- Skills -->
            @if(houseHelp.skills && houseHelp.skills.length > 0){
              <div class="skills-section">
                <div class="skills-label">Skills</div>
                <div class="skills-tags">
                  @for (skill of houseHelp.skills | slice:0:3; track $index) {
                    <span class="skill-tag">{{ skill }}</span>
                  }
                  @if(houseHelp.skills.length > 3){
                    <span class="skill-tag more">+{{ houseHelp.skills.length - 3 }}</span>
                  }
                </div>
              </div>
            }
          </mat-card-content>

          <mat-card-actions class="card-actions">
            <button
              mat-raised-button
              color="primary"
              class="view-profile-btn"
              (click)="seeDetails(houseHelp.id)"
            >
              <mat-icon>visibility</mat-icon>
              View Profile
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    }
  </div>

  <!-- Paginator -->
  <div class="d-flex justify-content-center mt-4">
    <mat-paginator
      [length]="(houseHelps$ | async)?.length"
      [pageSize]="(houseHelps$ | async)?.pages?.pageSize"
      (page)="onPageChange($event)"
    >
    </mat-paginator>
  </div>
</div>
